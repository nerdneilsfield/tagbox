# 项目名称：TagBox - 本地文件智能标签管理工具

## 一、项目背景与目标

在多平台使用、文件类型多样化与信息归档需求不断增强的今天，传统操作系统的文件夹体系已难以满足用户对文件的灵活组织与快速检索需求。TagBox 致力于构建一个"无需服务端、可结构化、轻量扩展"的本地文件管理工具。

项目目标如下：

* 实现基于标签、分类、元信息的文件管理与搜索
* 保持完全本地运行，无需服务端、支持同步盘部署
* 提供最小化 GUI 和 CLI 操作入口，简洁高效
* 可未来扩展 AI 进行内容理解与标签推荐

## 二、核心功能概述

### 1. 文件导入与分类

* 支持用户手动导入文件或批量导入目录
* 自动生成文件唯一 ID（UUID）与 hash（初始与当前）
* 可配置分类目录结构（最大3层）与重命名模板
* 支持填写元信息：标题、作者、年份、出版社、来源、摘要、多标签、唯一分类
* 支持从文件名、附属 JSON 文件、PDF 元数据等自动提取初步信息（metaInfo）供用户确认与补充

### 2. 元数据与文件管理

* 文件元数据存入 SQLite，支持修改、补全与维护
* 支持层级标签管理，格式如："语言/Rust"
* 每个文件可添加多个摘要条目
* 支持建立文件之间的语义关系（引用、派生等）
* 作者支持多个笔名归一归属与作者详情页面

### 3. 搜索与访问

* 提供模糊搜索功能（基于 SQLite + Signal FTS5 Extension，支持中文分词）
* 支持简化 DSL 查询语法，如：`tag:Rust author:张三 -tag:旧版`
* 支持按标签、分类、作者等字段过滤
* 支持获取文件完整路径，由前端决定是打开、跳转目录还是复制路径

### 4. 系统结构与运行方式

* 核心逻辑为独立 Rust 库（tagbox-core）
* 提供 CLI (TUI) 工具与 GUI (fltk-rs) 图形界面
* 所有数据本地存储，兼容同步盘使用
* 最小化依赖，无缩略图或富媒体处理

## 三、技术架构设计

| 层级   | 组件          | 技术方案                                    |
| ---- | ----------- | --------------------------------------- |
| 核心库  | tagbox-core | Rust + SQLite + Signal FTS5 + sea-query |
| CLI  | tagbox-cli  | clap + serde\_json                      |
| TUI  | tagbox-tui  | ratatui（tui-rs 分支，活跃维护）                 |
| GUI  | tagbox-gui  | fltk-rs                                 |
| 数据库  | SQLite      | 支持中文的 FTS5 多语言全文搜索扩展                    |
| 配置管理 | TOML/YAML   | 支持模板与规则配置                               |

## 四、关键设计要素

### 文件标识机制

* UUID：逻辑主键，不随文件变动变化
* initial\_hash：导入时内容 hash，防止重复导入
* current\_hash：当前 hash，识别文件变动状态

### 元信息结构

* title、authors、year、publisher、source\_url
* category（唯一）、tags（多值层级）、summaries（多条）
* linked\_files：语义链接表
* authors: 支持作者主名、笔名归一、作者信息页

### 分类与命名模板

* 分类路径模板：如 `{category1}/{category2}/{filename}`
* 文件名模板：如 `{title}_{authors}_{year}_{publisher}`
* 用户可通过配置文件（TOML）进行自定义

## 五、对外交互接口设计

### 1. URL Scheme 支持（跨工具跳转）

* 注册 `tagbox://` 协议，支持以下格式：

  * `tagbox://open?id=abc123` 打开文件
  * `tagbox://search?q=tag:Rust` 触发搜索
  * `tagbox://edit?id=abc123` 编辑元信息

### 2. CLI 命令调用

* 支持常规命令调用方式：

  ```bash
  tagbox-cli search --tag Rust --author 张三 --json
  tagbox-cli path abc123               # 获取文件完整路径
  ```
* 返回结果为 JSON，便于脚本处理与插件集成

### 3. Stdio 模式（推荐用于集成工具调用）

* 支持从 stdin 输入 JSON，输出 JSON 结果：

  ```bash
  echo '{"cmd": "search", "query": "tag:Rust"}' | tagbox-cli --stdio
  ```
* 支持命令包括：

  * `search`：执行搜索查询
  * `path`：返回文件绝对路径
  * `open`：打开指定文件
  * `import`：导入文件并附带元数据
  * `edit`：修改已有条目的元信息

---

## 六、版本计划

### v0.1 MVP

* 实现导入、分类、重命名、基础元信息填充
* 支持基本搜索 + 系统打开
* CLI 与 GUI 原型初步成型

### v0.2

* 简化 DSL 查询语法支持
* 文件双链功能加入
* 可批量修改、编辑元信息

### v0.3+

* AI 辅助摘要生成与 tag 建议
* 可视化文件网络图（可选）
* 插件机制初探

### 🚧 v0.4+ 功能规划

* 支持“作者归并关系”与作者实体信息页
* 支持标签/分类独立表管理，支持多对多关联、层级结构
* 支持软删除机制（is\_deleted + deleted\_at），支持回收站逻辑与定期清理
* 支持热点文件记录（访问日志或访问计数）用于推荐/快速打开
* 支持作者页、分类页、标签页的可视化入口（GUI）

## 七、竞品差异点

| 功能/工具   | Zotero | Obsidian | TagSpaces | 你的工具 |
| ------- | ------ | -------- | --------- | ---- |
| 本地优先    | ✅      | ✅        | ✅         | ✅    |
| 标签管理    | ✅      | ✅        | ✅         | ✅    |
| 分类管理    | ✅      | ✅        | ❌         | ✅    |
| 元数据支持   | ✅      | ✅        | ❌         | ✅    |
| AI能力拓展  | ❌      | ✅        | ❌         | ✅    |
| 文件重命名控制 | ❌      | ❌        | ✅         | ✅    |
| CLI 操作  | ❌      | ✅        | ❌         | ✅    |

## 八、目标用户画像

* 熟练使用本地文件系统，重视数据控制与私密性
* 有归档、管理、查找、笔记整理等需求
* 希望统一管理 PDF、图片、文档等多种类型资料
* 不满足于传统文件夹体系，寻求语义级组织
